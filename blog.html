<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Primary Meta Tags -->
    <title>Mine - Nơi Đồ Cũ Viết Tiếp Câu Chuyện Xanh | Mua Bán Đồ Cũ Bền Vững</title>
    <meta name="title" content="Mine - Nơi Đồ Cũ Viết Tiếp Câu Chuyện Xanh">
    <meta name="description"
        content="Mine - Nền tảng mua bán đồ cũ hàng đầu Việt Nam. Tìm kiếm bất động sản, xe cộ, đồ điện tử, gia dụng đã qua sử dụng với chất lượng tốt. Góp phần bảo vệ môi trường qua kinh tế tuần hoàn.">
    <meta name="keywords"
        content="đồ cũ, mua bán đồ cũ, bất động sản cũ, xe cũ, đồ điện tử cũ, đồ gia dụng cũ, kinh tế tuần hoàn, bảo vệ môi trường, second hand, recycle">
    <meta name="robots" content="index, follow">
    <meta name="language" content="Vietnamese">
    <meta name="author" content="Mine">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.0/flowbite.min.css" rel="stylesheet" />
    <link rel="icon" href="Picture/logo.png" type="image/svg+xml">
    <link rel="icon" href="Picture/logo.png" type="image/x-icon">
    <link rel="icon" href="Picture/logo.png" type="image/png">
    <link rel="apple-touch-icon" href="Picture/logo.png">
    <style>
        .img.h-12.w-12.text-green-600 {
            border-radius: 30px;
        }

        svg.h-12.w-12.text-green-600.rounded-full,
        img.h-12.w-12.text-green-600,
        video.h-12.w-12.rounded-full.object-cover {
            border-radius: 50% !important;
        }

        /* Blog-specific styles */
        .bg-gray-750 {
            background-color: rgb(55 65 81);
        }

        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .line-clamp-4 {
            display: -webkit-box;
            -webkit-line-clamp: 4;
            line-clamp: 4;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Modal animations */
        .modal-enter {
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(-20px);
            }

            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        /* Scrollbar styling for dark theme */
        .overflow-y-auto::-webkit-scrollbar {
            width: 8px;
        }

        .overflow-y-auto::-webkit-scrollbar-track {
            background: rgb(75 85 99);
            border-radius: 4px;
        }

        .overflow-y-auto::-webkit-scrollbar-thumb {
            background: rgb(107 114 128);
            border-radius: 4px;
        }

        .overflow-y-auto::-webkit-scrollbar-thumb:hover {
            background: rgb(156 163 175);
        }

        /* Form focus improvements */
        .focus\:ring-green-500:focus {
            --tw-ring-color: rgb(34 197 94);
            box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.1);
        }

        /* Notification toast */
        .notification-toast {
            -webkit-backdrop-filter: blur(8px);
            backdrop-filter: blur(8px);
        }

        /* Blog card hover effects */
        .blog-card {
            transition: all 0.2s ease-in-out;
        }

        .blog-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.1);
        }

        /* Responsive improvements */
        @media (max-width: 640px) {
            .modal-container {
                margin: 1rem;
                max-height: calc(100vh - 2rem);
            }
        }
    </style>
</head>

<nav class="bg-gray-800 border-gray-700 dark:bg-gray-900 fixed w-full z-50 shadow-sm">
    <div class="max-w-screen-xl flex items-center mx-auto p-3">
        <!-- Logo và tên -->
        <a href="#" class="flex items-center space-x-2 flex-shrink-0">
            <img src="Picture/logo.png" class="h-10" alt="Mine Logo">
            <span class="self-center text-xl font-bold text-white">Mine</span>
        </a>

        <!-- Menu chính (ẩn trên mobile/tablet) -->
        <div class="hidden lg:flex items-center space-x-6 ml-8">
            <a href="index.html" class="text-white hover:text-green-400 transition-colors">Trang chủ</a>
            <a href="mua_fixed.html" class="text-white hover:text-green-400 transition-colors">Mua sắm</a>
            <a href="service.html" class="text-white hover:text-green-400 transition-colors">Dịch vụ</a>
            <a href="timhieuthem.html" class="text-white hover:text-green-400 transition-colors">Về chúng tôi</a>
            <a href="contact.html" class="text-white hover:text-green-400 transition-colors">Liên hệ</a>
        </div>

        <!-- Spacer để đẩy actions về bên phải -->
        <div class="flex-1"></div>

        <!-- Actions (giỏ hàng, đăng bán, đăng nhập) -->
        <div class="flex items-center space-x-3 flex-shrink-0">
            <!-- Giỏ hàng với icon đẹp hơn -->
            <a href="cart.html" class="relative p-2 text-white hover:text-green-400 transition-colors" title="Giỏ hàng">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M16 11V7a4 4 0 00-8 0v4M5 9h14l-1 7H6L5 9z" />
                </svg>
                <span id="cart-count"
                    class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center hidden">0</span>
            </a>

            <!-- Nút đăng bán -->
            <a href="dang_ban.html"
                class="px-4 py-2 text-sm font-medium text-white bg-green-600 hover:bg-green-700 rounded-lg transition-colors">
                Đăng bán
            </a>
            <button data-collapse-toggle="navbar-default" type="button"
                class="inline-flex items-center p-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200"
                aria-controls="navbar-default" aria-expanded="false">
                <span class="sr-only">Open main menu</span>
                <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                    viewBox="0 0 17 14">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M1 1h15M1 7h15M1 13h15" />
                </svg>
            </button>
            <div class="hidden w-full md:block md:w-auto" id="navbar-default">
                <ul
                    class="font-medium flex flex-col p-4 md:p-0 mt-4 border border-gray-100 rounded-lg bg-gray-50 md:flex-row md:space-x-8 rtl:space-x-reverse md:mt-0 md:border-0 md:bg-white dark:bg-gray-800 md:dark:bg-gray-900 dark:border-gray-700">
                    <li class="relative flex items-center space-x-2">
                        <div class="relative h-8 w-8 flex items-center justify-center">
                            <svg class="h-8 w-8 text-green-600" fill="currentColor" viewBox="0 0 24 24">
                                <path
                                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5.94 7.94l-4.47 4.47-2.4-2.4-1.42 1.42 3.82 3.82 5.89-5.89-1.42-1.42z" />
                                <path d="M12 7v3M9 10h6M12 13v3" class="text-white" />
                            </svg>
                        </div>
                        <button id="dropdown-toggle" class="text-gray-500 hover:text-gray-700 ml-1"
                            title="Toggle dropdown">
                            <svg id="arrow-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20"
                                fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M5.293 9.293a1 1 0 011.414 0L10 12.586l3.293-3.293a1 1 0 011.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                    clip-rule="evenodd" />
                            </svg>
                        </button>
                        <div id="dropdown-content"
                            class="hidden absolute top-full mt-2 w-60 bg-white border border-gray-300 rounded-lg shadow-lg end-0">
                            <div class="p-4">
                                <div class="flex items-start mb-4">
                                    <!-- Avatar container with pencil icon -->
                                    <div id="avatar-container" class="relative flex-shrink-0 mr-3">
                                        <svg class="h-12 w-12 text-green-600" fill="currentColor" viewBox="0 0 24 24">
                                            <path
                                                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5.94 7.94l-4.47 4.47-2.4-2.4-1.42 1.42 3.82 3.82 5.89-5.89-1.42-1.42z" />
                                            <path d="M12 7v3M9 10h6M12 13v3" class="text-white" />
                                        </svg>
                                        <!-- Icon cây viết chì bên cạnh avatar -->
                                        <button id="pencil-edit-button"
                                            class="absolute -bottom-1 -right-1 bg-white rounded-full p-0.5 shadow-md hover:bg-gray-50 transition-colors z-10"
                                            title="Đổi avatar">
                                            <svg class="h-3 w-3 text-gray-600" fill="none" stroke="currentColor"
                                                viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z">
                                                </path>
                                            </svg>
                                        </button>
                                    </div>
                                    <!-- User info -->
                                    <div class="flex-1 min-w-0">
                                        <p class="text-sm font-medium whitespace-nowrap overflow-hidden text-ellipsis">
                                            Trần Hữu Hải Đăng</p>
                                        <p
                                            class="text-xs text-gray-500 whitespace-nowrap overflow-hidden text-ellipsis">
                                            TK Định danh: C0888293...</p>
                                    </div>
                                </div>
                                <input type="file" id="avatar-input" accept="image/*,video/*" class="hidden"
                                    title="Chọn avatar mới" placeholder="Chọn file avatar">
                                <ul class="mt-2 space-y-1">
                                    <li><a href="public-maps.html"
                                            class="block text-sm text-gray-700 hover:underline">Bản đồ công khai</a>
                                    </li>
                                    <li><a href="blog.html" class="block text-sm text-gray-700 hover:underline">Blog</a>
                                    </li>
                                    <li><a href="event.html" class="block text-sm text-gray-700 hover:underline">Sự
                                            kiện</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>


        </div>

</nav>

<!-- Main Content -->
<main class="pt-20 min-h-screen bg-gray-900">
    <!-- Blog Management Section -->
    <div class="max-w-7xl mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-12">
            <h1 class="text-4xl font-bold text-white mb-4">Environmental Research Hub</h1>
            <p class="text-xl text-gray-300">Cập nhật hàng ngày những nghiên cứu mới nhất về bảo vệ môi trường</p>
        </div>

        <!-- Add New Blog Button -->
        <div class="text-center mb-8">
            <button id="addBlogBtn"
                class="bg-green-600 hover:bg-green-700 text-white px-8 py-3 rounded-lg font-semibold transition-colors duration-200 shadow-lg">
                <svg class="inline-block w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                </svg>
                Đăng bài nghiên cứu mới
            </button>
        </div>

        <!-- Blog Grid -->
        <div id="blogGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
            <!-- Blog posts will be dynamically added here -->
        </div>

        <!-- No blogs message -->
        <div id="noBlogsMessage" class="text-center text-gray-400 py-16 hidden">
            <svg class="w-16 h-16 mx-auto mb-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                </path>
            </svg>
            <h3 class="text-xl font-semibold mb-2">Chưa có bài nghiên cứu nào</h3>
            <p>Hãy bắt đầu bằng cách thêm bài nghiên cứu đầu tiên của bạn!</p>
        </div>
    </div>

    <!-- Add/Edit Blog Modal -->
    <div id="blogModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-gray-800 rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-700">
                <div class="flex items-center justify-between">
                    <h2 id="modalTitle" class="text-2xl font-bold text-white">Thêm bài nghiên cứu mới</h2>
                    <button id="closeModal" class="text-gray-400 hover:text-white transition-colors" title="Đóng">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <form id="blogForm" class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Tiêu đề nghiên cứu *</label>
                    <input type="text" id="blogTitle" required maxlength="200"
                        class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:ring-2 focus:ring-green-500 focus:border-transparent"
                        placeholder="VD: Tác động của biến đổi khí hậu đến hệ sinh thái rừng nhiệt đới">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Tác giả *</label>
                    <input type="text" id="blogAuthor" required maxlength="100"
                        class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:ring-2 focus:ring-green-500 focus:border-transparent"
                        placeholder="Tên tác giả hoặc nhóm nghiên cứu">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Tóm tắt nghiên cứu *</label>
                    <textarea id="blogSummary" required maxlength="500" rows="4"
                        class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none"
                        placeholder="Tóm tắt ngắn gọn về nội dung, phương pháp và kết quả nghiên cứu (tối đa 500 ký tự)"></textarea>
                    <div class="text-right text-sm text-gray-400 mt-1">
                        <span id="summaryCount">0</span>/500
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Nội dung chi tiết *</label>
                    <textarea id="blogContent" required maxlength="5000" rows="8"
                        class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none"
                        placeholder="Nội dung chi tiết về nghiên cứu, phương pháp thực hiện, kết quả và kết luận..."></textarea>
                    <div class="text-right text-sm text-gray-400 mt-1">
                        <span id="contentCount">0</span>/5000
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Link bài báo gốc (tùy chọn)</label>
                    <input type="url" id="blogUrl"
                        class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:ring-2 focus:ring-green-500 focus:border-transparent"
                        placeholder="https://example.com/research-paper">
                </div>

                <div class="flex space-x-4 pt-4">
                    <button type="submit"
                        class="flex-1 bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors duration-200">
                        <span id="submitBtnText">Đăng bài</span>
                    </button>
                    <button type="button" id="cancelBtn"
                        class="flex-1 bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors duration-200">
                        Hủy
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Blog Detail Modal -->
    <div id="blogDetailModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-gray-800 rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-700">
                <div class="flex items-center justify-between">
                    <h2 id="detailTitle" class="text-2xl font-bold text-white"></h2>
                    <div class="flex space-x-2">
                        <button id="editBlogBtn" class="text-green-400 hover:text-green-300 transition-colors p-2"
                            title="Chỉnh sửa">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z">
                                </path>
                            </svg>
                        </button>
                        <button id="deleteBlogBtn" class="text-red-400 hover:text-red-300 transition-colors p-2"
                            title="Xóa bài">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                                </path>
                            </svg>
                        </button>
                        <button id="closeDetailModal" class="text-gray-400 hover:text-white transition-colors p-2"
                            title="Đóng">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <div class="p-6">
                <div class="mb-6">
                    <div class="flex flex-wrap items-center text-sm text-gray-400 mb-4">
                        <span class="mr-4">
                            <svg class="inline w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                            <span id="detailAuthor"></span>
                        </span>
                        <span class="mr-4">
                            <svg class="inline w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M8 7V3a1 1 0 011-1h6a1 1 0 011 1v4h3a1 1 0 011 1v3H5V8a1 1 0 011-1h2z">
                                </path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M7 21h10a1 1 0 001-1v-8H6v8a1 1 0 001 1z"></path>
                            </svg>
                            <span id="detailDate"></span>
                        </span>
                        <span id="detailUrlContainer" class="hidden">
                            <a id="detailUrl" href="#" target="_blank"
                                class="text-green-400 hover:text-green-300 transition-colors">
                                <svg class="inline w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14">
                                    </path>
                                </svg>
                                Xem bài báo gốc
                            </a>
                        </span>
                    </div>
                </div>

                <div class="mb-6">
                    <h3 class="text-lg font-semibold text-gray-200 mb-3">Tóm tắt</h3>
                    <p id="detailSummary" class="text-gray-300 leading-relaxed"></p>
                </div>

                <div>
                    <h3 class="text-lg font-semibold text-gray-200 mb-3">Nội dung chi tiết</h3>
                    <div id="detailContent" class="text-gray-300 leading-relaxed prose prose-invert max-w-none">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-gray-800 rounded-xl shadow-2xl w-full max-w-md">
            <div class="p-6">
                <div class="flex items-center mb-4">
                    <div class="w-12 h-12 rounded-full bg-red-100 flex items-center justify-center mr-4">
                        <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z">
                            </path>
                        </svg>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-white">Xác nhận xóa bài</h3>
                        <p class="text-gray-300 text-sm">Hành động này không thể hoàn tác</p>
                    </div>
                </div>

                <p class="text-gray-300 mb-6">Bạn có chắc chắn muốn xóa bài nghiên cứu này không?</p>

                <div class="flex space-x-3">
                    <button id="confirmDeleteBtn"
                        class="flex-1 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors duration-200">
                        Xóa bài
                    </button>
                    <button id="cancelDeleteBtn"
                        class="flex-1 bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors duration-200">
                        Hủy
                    </button>
                </div>
            </div>
        </div>
    </div>
</main>

<footer class="bg-white dark:bg-gray-900">
    <div class="mx-auto w-full max-w-screen-xl p-4 py-6 lg:py-8">
        <div class="md:flex md:justify-between">
            <div class="mb-6 md:mb-0">
                <a href="#" class="flex items-center">
                    <img src="Picture/logo.png" class="h-10 me-3" alt="Green Map Logo" />
                    <span class="self-center text-2xl font-semibold whitespace-nowrap dark:text-white">Mine</span>
                </a>
            </div>
            <div class="grid grid-cols-2 gap-8 sm:gap-6 sm:grid-cols-3">
                <div>
                    <h2 class="mb-6 text-sm font-semibold text-gray-900 uppercase dark:text-white">Resources
                    </h2>
                    <ul class="text-gray-500 dark:text-gray-400 font-medium">
                        <li class="mb-4">
                            <a href="#" class="hover:underline">Conservation</a>
                        </li>
                        <li>
                            <a href="#" class="hover:underline">Blog</a>
                        </li>
                    </ul>
                </div>
                <div>
                    <h2 class="mb-6 text-sm font-semibold text-gray-900 uppercase dark:text-white">Follow us
                    </h2>
                    <ul class="text-gray-500 dark:text-gray-400 font-medium">
                        <li class="mb-4">
                            <a href="#" class="hover:underline ">Facebook</a>
                        </li>
                        <li>
                            <a href="#" class="hover:underline">Twitter</a>
                        </li>
                    </ul>
                </div>
                <div>
                    <h2 class="mb-6 text-sm font-semibold text-gray-900 uppercase dark:text-white">Legal</h2>
                    <ul class="text-gray-500 dark:text-gray-400 font-medium">
                        <li class="mb-4">
                            <a href="#" class="hover:underline">Privacy Policy</a>
                        </li>
                        <li>
                            <a href="#" class="hover:underline">Terms &amp; Conditions</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="sm:flex sm:items-center sm:justify-between"></div>
    </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.0/flowbite.min.js"></script>
<script>
    // Optimized JavaScript with better error handling and performance
    (function () {
        'use strict';

        // Cache DOM elements and state
        let isDropdownOpen = false;
        let eventListenersAttached = false;

        // Utility functions
        const utils = {
            createElement: (tag, className, attributes = {}) => {
                const element = document.createElement(tag);
                if (className) element.className = className;
                Object.entries(attributes).forEach(([key, value]) => {
                    element.setAttribute(key, value);
                });
                return element;
            },

            debounce: (func, wait) => {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            },

            validateFile: (file) => {
                const maxSize = 10 * 1024 * 1024; // 10MB
                const allowedTypes = ['image/', 'video/'];

                if (!file) return { valid: false, error: 'Không có file được chọn' };
                if (file.size > maxSize) return { valid: false, error: 'File quá lớn. Vui lòng chọn file nhỏ hơn 10MB.' };
                if (!allowedTypes.some(type => file.type.startsWith(type))) {
                    return { valid: false, error: 'Định dạng file không được hỗ trợ. Chỉ chấp nhận hình ảnh và video.' };
                }

                return { valid: true };
            },

            safeLocalStorage: {
                setItem: (key, value) => {
                    try {
                        localStorage.setItem(key, JSON.stringify(value));
                        return true;
                    } catch (error) {
                        console.warn('Không thể lưu vào localStorage:', error);
                        return false;
                    }
                },

                getItem: (key) => {
                    try {
                        const item = localStorage.getItem(key);
                        return item ? JSON.parse(item) : null;
                    } catch (error) {
                        console.warn('Không thể đọc từ localStorage:', error);
                        return null;
                    }
                }
            }
        };

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function () {
            initDropdown();
            initAvatarSystem();
        });

        function updateCartCount() {
            const cart = utils.safeLocalStorage.getItem('cart') || [];
            const cartCount = cart.reduce((total, item) => {
                return total + (parseInt(item.quantity) || 0);
            }, 0);

            const cartCountElement = document.getElementById('cart-count');

            if (cartCountElement) {
                if (cartCount > 0) {
                    cartCountElement.textContent = cartCount > 99 ? '99+' : cartCount;
                    cartCountElement.classList.remove('hidden');
                } else {
                    cartCountElement.classList.add('hidden');
                }
            }
        }

        // --- 1. Dropdown Management ---
        function initDropdown() {
            const dropdownToggle = document.getElementById('dropdown-toggle');
            const dropdownContent = document.getElementById('dropdown-content');
            const arrowIcon = document.getElementById('arrow-icon');

            if (!dropdownToggle || !dropdownContent || !arrowIcon) {
                console.warn('Dropdown elements not found');
                return;
            }

            const toggleDropdown = (e) => {
                e.stopPropagation();
                isDropdownOpen = !isDropdownOpen;

                dropdownContent.classList.toggle('hidden', !isDropdownOpen);
                arrowIcon.classList.toggle('rotate-180', isDropdownOpen);
            };

            const closeDropdown = () => {
                if (isDropdownOpen) {
                    isDropdownOpen = false;
                    dropdownContent.classList.add('hidden');
                    arrowIcon.classList.remove('rotate-180');
                }
            };

            // Click outside to close dropdown
            const handleOutsideClick = (event) => {
                if (!dropdownToggle.contains(event.target) && !dropdownContent.contains(event.target)) {
                    closeDropdown();
                }
            };

            // Escape key to close dropdown
            const handleKeyPress = (event) => {
                if (event.key === 'Escape' && isDropdownOpen) {
                    closeDropdown();
                }
            };

            // Attach event listeners
            dropdownToggle.addEventListener('click', toggleDropdown);
            document.addEventListener('click', handleOutsideClick);
            document.addEventListener('keydown', handleKeyPress);
        }

        // --- 2. Avatar System ---
        function initAvatarSystem() {
            const avatarFileInput = document.getElementById('avatar-input');
            const navAvatarContainer = document.querySelector('.relative.h-8.w-8');
            const avatarContainer = document.getElementById('avatar-container');

            if (!avatarFileInput || !avatarContainer) {
                console.warn('Avatar elements not found');
                return;
            }

            // Create avatar element based on type and container
            function createAvatarElement(src, type, containerType) {
                let element;
                const isImage = type.startsWith('image/');
                const isVideo = type.startsWith('video/');

                if (isImage) {
                    element = utils.createElement('img', '', {
                        src,
                        alt: 'Avatar',
                        loading: 'lazy'
                    });
                } else if (isVideo) {
                    element = utils.createElement('video', '', {
                        src,
                        autoplay: 'true',
                        loop: 'true',
                        muted: 'true'
                    });
                }

                if (element) {
                    element.className = containerType === 'nav'
                        ? 'h-8 w-8 rounded-full object-cover'
                        : 'h-12 w-12 rounded-full object-cover';

                    // Add error handling for media elements
                    element.onerror = () => {
                        console.error('Failed to load avatar media');
                        // Could implement fallback avatar here
                    };
                }

                return element;
            }

            // Update avatar display in all locations
            function updateAvatarDisplay(src, type) {
                // Update nav avatar
                if (navAvatarContainer) {
                    const newNavAvatar = createAvatarElement(src, type, 'nav');
                    if (newNavAvatar) {
                        navAvatarContainer.innerHTML = '';
                        navAvatarContainer.appendChild(newNavAvatar);
                    }
                }

                // Update dropdown avatar
                if (avatarContainer) {
                    const currentAvatar = avatarContainer.querySelector('svg, img, video');
                    const newDropdownAvatar = createAvatarElement(src, type, 'dropdown');

                    if (currentAvatar && newDropdownAvatar) {
                        currentAvatar.replaceWith(newDropdownAvatar);
                    }

                    // Ensure pencil button exists and is functional
                    ensurePencilButton();
                }
            }

            // Ensure pencil edit button exists and works
            function ensurePencilButton() {
                let pencilButton = avatarContainer.querySelector('#pencil-edit-button');

                if (!pencilButton) {
                    pencilButton = utils.createElement('button',
                        'absolute -bottom-1 -right-1 bg-white rounded-full p-0.5 shadow-md hover:bg-gray-50 transition-colors z-10',
                        {
                            id: 'pencil-edit-button',
                            title: 'Đổi avatar',
                            'aria-label': 'Đổi avatar'
                        }
                    );

                    pencilButton.innerHTML = `
                                <svg class="h-3 w-3 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                          d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z">
                                    </path>
                                </svg>
                            `;

                    avatarContainer.appendChild(pencilButton);
                }

                // Remove existing listeners to prevent duplicates
                const newPencilButton = pencilButton.cloneNode(true);
                pencilButton.replaceWith(newPencilButton);

                // Add click handler
                newPencilButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    avatarFileInput.click();
                });
            }

            // Handle file input change
            const handleFileChange = utils.debounce((event) => {
                const file = event.target.files[0];
                const validation = utils.validateFile(file);

                if (!validation.valid) {
                    alert(validation.error);
                    // Reset input
                    event.target.value = '';
                    return;
                }

                const reader = new FileReader();

                reader.onload = (e) => {
                    const src = e.target.result;
                    const type = file.type;

                    updateAvatarDisplay(src, type);
                    utils.safeLocalStorage.setItem('avatar', { src, type });
                };

                reader.onerror = () => {
                    alert('Lỗi khi đọc file. Vui lòng thử lại.');
                };

                reader.readAsDataURL(file);
            }, 300);

            // Load saved avatar from localStorage
            function loadSavedAvatar() {
                const savedAvatar = utils.safeLocalStorage.getItem('avatar');
                if (savedAvatar && savedAvatar.src && savedAvatar.type) {
                    updateAvatarDisplay(savedAvatar.src, savedAvatar.type);
                } else {
                    // Ensure default pencil button is functional
                    ensurePencilButton();
                }
            }

            // Initialize avatar system
            avatarFileInput.addEventListener('change', handleFileChange);
            loadSavedAvatar();
        }

        // Update cart count in navigation
        function updateCartCount() {
            const cart = utils.safeLocalStorage.getItem('cart') || [];
            const cartCount = cart.reduce((total, item) => {
                return total + (parseInt(item.quantity) || 0);
            }, 0);

            const cartCountElement = document.getElementById('cart-count');

            if (cartCountElement) {
                if (cartCount > 0) {
                    cartCountElement.textContent = cartCount > 99 ? '99+' : cartCount;
                    cartCountElement.classList.remove('hidden');
                } else {
                    cartCountElement.classList.add('hidden');
                }
            }
        }

        // Search functionality
        function initializeSearch() {
            const searchInput = document.getElementById('search-input');
            const searchBtn = document.getElementById('search-btn');
            const categoryFilter = document.getElementById('category-filter');
            const searchTags = document.querySelectorAll('.search-tag');

            // Handle search button click
            function performSearch() {
                const searchTerm = searchInput.value.trim();
                const category = categoryFilter.value;

                // Build URL parameters
                const params = new URLSearchParams();
                if (searchTerm) params.set('search', searchTerm);
                if (category) params.set('category', category);

                // Redirect to mua.html with search parameters
                const url = category || searchTerm ? `mua.html?${params.toString()}` : 'mua.html';
                window.location.href = url;
            }

            // Event listeners
            if (searchBtn) {
                searchBtn.addEventListener('click', performSearch);
            }

            if (searchInput) {
                searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        performSearch();
                    }
                });
            }

            // Handle category filter change
            if (categoryFilter) {
                categoryFilter.addEventListener('change', () => {
                    if (categoryFilter.value) {
                        performSearch();
                    }
                });
            }

            // Handle search tag clicks
            searchTags.forEach(tag => {
                tag.addEventListener('click', () => {
                    const filter = tag.getAttribute('data-filter');
                    if (filter) {
                        searchInput.value = filter;
                        performSearch();
                    }
                });
            });

            // Update cart count when page loads
            updateCartCount();
        }

        // Initialize search functionality
        initializeSearch();
    })();
</script>
<script>
    // Optimized JavaScript with better error handling and performance
    (function () {
        'use strict';

        // Cache DOM elements and state
        let isDropdownOpen = false;
        let eventListenersAttached = false;

        // Utility functions
        const utils = {
            createElement: (tag, className, attributes = {}) => {
                const element = document.createElement(tag);
                if (className) element.className = className;
                Object.entries(attributes).forEach(([key, value]) => {
                    element.setAttribute(key, value);
                });
                return element;
            },

            debounce: (func, wait) => {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            },

            validateFile: (file) => {
                const maxSize = 10 * 1024 * 1024; // 10MB
                const allowedTypes = ['image/', 'video/'];

                if (!file) return { valid: false, error: 'Không có file được chọn' };
                if (file.size > maxSize) return { valid: false, error: 'File quá lớn. Vui lòng chọn file nhỏ hơn 10MB.' };
                if (!allowedTypes.some(type => file.type.startsWith(type))) {
                    return { valid: false, error: 'Định dạng file không được hỗ trợ. Chỉ chấp nhận hình ảnh và video.' };
                }

                return { valid: true };
            },

            safeLocalStorage: {
                setItem: (key, value) => {
                    try {
                        localStorage.setItem(key, JSON.stringify(value));
                        return true;
                    } catch (error) {
                        console.warn('Không thể lưu vào localStorage:', error);
                        return false;
                    }
                },

                getItem: (key) => {
                    try {
                        const item = localStorage.getItem(key);
                        return item ? JSON.parse(item) : null;
                    } catch (error) {
                        console.warn('Không thể đọc từ localStorage:', error);
                        return null;
                    }
                }
            }
        };

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function () {
            initDropdown();
            initAvatarSystem();
        });

        // --- 1. Dropdown Management ---
        function initDropdown() {
            const dropdownToggle = document.getElementById('dropdown-toggle');
            const dropdownContent = document.getElementById('dropdown-content');
            const arrowIcon = document.getElementById('arrow-icon');

            if (!dropdownToggle || !dropdownContent || !arrowIcon) {
                console.warn('Dropdown elements not found');
                return;
            }

            const toggleDropdown = (e) => {
                e.stopPropagation();
                isDropdownOpen = !isDropdownOpen;

                dropdownContent.classList.toggle('hidden', !isDropdownOpen);
                arrowIcon.classList.toggle('rotate-180', isDropdownOpen);
            };

            const closeDropdown = () => {
                if (isDropdownOpen) {
                    isDropdownOpen = false;
                    dropdownContent.classList.add('hidden');
                    arrowIcon.classList.remove('rotate-180');
                }
            };

            // Click outside to close dropdown
            const handleOutsideClick = (event) => {
                if (!dropdownToggle.contains(event.target) && !dropdownContent.contains(event.target)) {
                    closeDropdown();
                } 3
            };

            // Escape key to close dropdown and modal
            const handleKeyPress = (event) => {
                if (event.key === 'Escape') {
                    if (isDropdownOpen) {
                        closeDropdown();
                    } else if (isModalOpen) {
                        closeModal();
                    }
                }
            };

            // Attach event listeners
            dropdownToggle.addEventListener('click', toggleDropdown);
            document.addEventListener('click', handleOutsideClick);
            document.addEventListener('keydown', handleKeyPress);
        }

        // --- 2. Avatar System ---
        function initAvatarSystem() {
            const avatarFileInput = document.getElementById('avatar-input');
            const navAvatarContainer = document.querySelector('.relative.h-8.w-8');
            const avatarContainer = document.getElementById('avatar-container');

            if (!avatarFileInput || !avatarContainer) {
                console.warn('Avatar elements not found');
                return;
            }

            // Create avatar element based on type and container
            function createAvatarElement(src, type, containerType) {
                let element;
                const isImage = type.startsWith('image/');
                const isVideo = type.startsWith('video/');

                if (isImage) {
                    element = utils.createElement('img', '', {
                        src,
                        alt: 'Avatar',
                        loading: 'lazy'
                    });
                } else if (isVideo) {
                    element = utils.createElement('video', '', {
                        src,
                        autoplay: 'true',
                        loop: 'true',
                        muted: 'true'
                    });
                }

                if (element) {
                    element.className = containerType === 'nav'
                        ? 'h-8 w-8 rounded-full object-cover'
                        : 'h-12 w-12 rounded-full object-cover';

                    // Add error handling for media elements
                    element.onerror = () => {
                        console.error('Failed to load avatar media');
                        // Could implement fallback avatar here
                    };
                }

                return element;
            }

            // Update avatar display in all locations
            function updateAvatarDisplay(src, type) {
                // Update nav avatar
                if (navAvatarContainer) {
                    const newNavAvatar = createAvatarElement(src, type, 'nav');
                    if (newNavAvatar) {
                        navAvatarContainer.innerHTML = '';
                        navAvatarContainer.appendChild(newNavAvatar);
                    }
                }

                // Update dropdown avatar
                if (avatarContainer) {
                    const currentAvatar = avatarContainer.querySelector('svg, img, video');
                    const newDropdownAvatar = createAvatarElement(src, type, 'dropdown');

                    if (currentAvatar && newDropdownAvatar) {
                        currentAvatar.replaceWith(newDropdownAvatar);
                    }

                    // Ensure pencil button exists and is functional
                    ensurePencilButton();
                }
            }

            // Ensure pencil edit button exists and works
            function ensurePencilButton() {
                let pencilButton = avatarContainer.querySelector('#pencil-edit-button');

                if (!pencilButton) {
                    pencilButton = utils.createElement('button',
                        'absolute -bottom-1 -right-1 bg-white rounded-full p-0.5 shadow-md hover:bg-gray-50 transition-colors z-10',
                        {
                            id: 'pencil-edit-button',
                            title: 'Đổi avatar',
                            'aria-label': 'Đổi avatar'
                        }
                    );

                    pencilButton.innerHTML = `
                                <svg class="h-3 w-3 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                          d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z">
                                    </path>
                                </svg>
                            `;

                    avatarContainer.appendChild(pencilButton);
                }

                // Remove existing listeners to prevent duplicates
                const newPencilButton = pencilButton.cloneNode(true);
                pencilButton.replaceWith(newPencilButton);

                // Add click handler
                newPencilButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    avatarFileInput.click();
                });
            }

            // Handle file input change
            const handleFileChange = utils.debounce((event) => {
                const file = event.target.files[0];
                const validation = utils.validateFile(file);

                if (!validation.valid) {
                    alert(validation.error);
                    // Reset input
                    event.target.value = '';
                    return;
                }

                const reader = new FileReader();

                reader.onload = (e) => {
                    const src = e.target.result;
                    const type = file.type;

                    updateAvatarDisplay(src, type);
                    utils.safeLocalStorage.setItem('avatar', { src, type });
                };

                reader.onerror = () => {
                    alert('Lỗi khi đọc file. Vui lòng thử lại.');
                };

                reader.readAsDataURL(file);
            }, 300);

            // Load saved avatar from localStorage
            function loadSavedAvatar() {
                const savedAvatar = utils.safeLocalStorage.getItem('avatar');
                if (savedAvatar && savedAvatar.src && savedAvatar.type) {
                    updateAvatarDisplay(savedAvatar.src, savedAvatar.type);
                } else {
                    // Ensure default pencil button is functional
                    ensurePencilButton();
                }
            }

            // Initialize avatar system
            avatarFileInput.addEventListener('change', handleFileChange);
            loadSavedAvatar();
        }
    })();

    // --- 3. Blog Management System ---
    (function () {
        'use strict';

        let blogs = [];
        let editingBlogId = null;
        let isModalOpen = false;

        // Environmental keywords for content filtering
        const environmentalKeywords = [
            'môi trường', 'environment', 'khí hậu', 'climate', 'ô nhiễm', 'pollution',
            'sinh thái', 'ecosystem', 'bảo vệ', 'protection', 'conservation', 'bền vững',
            'sustainable', 'xanh', 'green', 'carbon', 'năng lượng', 'energy',
            'tái chế', 'recycling', 'rừng', 'forest', 'đại dương', 'ocean',
            'biến đổi khí hậu', 'global warming', 'nóng lên toàn cầu', 'biodiversity',
            'đa dạng sinh học', 'renewable', 'tái tạo', 'emission', 'phát thải',
            'waste', 'chất thải', 'water', 'nước', 'air quality', 'chất lượng không khí',
            'deforestation', 'phá rừng', 'wildlife', 'động vật hoang dã'
        ];

        // Initialize blog system
        document.addEventListener('DOMContentLoaded', function () {
            initBlogSystem();
        });

        function initBlogSystem() {
            loadBlogs();
            bindEvents();
            renderBlogs();
        }

        function bindEvents() {
            // Add blog button
            document.getElementById('addBlogBtn').addEventListener('click', () => {
                editingBlogId = null;
                openModal('Thêm bài nghiên cứu mới', 'Đăng bài');
            });

            // Modal close buttons
            document.getElementById('closeModal').addEventListener('click', closeModal);
            document.getElementById('cancelBtn').addEventListener('click', closeModal);
            document.getElementById('closeDetailModal').addEventListener('click', closeDetailModal);

            // Blog form submission
            document.getElementById('blogForm').addEventListener('submit', handleBlogSubmit);

            // Character counters
            document.getElementById('blogSummary').addEventListener('input', updateSummaryCounter);
            document.getElementById('blogContent').addEventListener('input', updateContentCounter);

            // Auto-save draft functionality
            const autoSaveFields = ['blogTitle', 'blogAuthor', 'blogSummary', 'blogContent', 'blogUrl'];
            autoSaveFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('input', debounce(saveDraft, 2000));
                    field.addEventListener('blur', saveDraft);
                }
            });

            // Delete confirmation
            document.getElementById('confirmDeleteBtn').addEventListener('click', confirmDelete);
            document.getElementById('cancelDeleteBtn').addEventListener('click', closeDeleteModal);

            // Click outside modal to close
            document.getElementById('blogModal').addEventListener('click', (e) => {
                if (e.target === e.currentTarget) closeModal();
            });
            document.getElementById('blogDetailModal').addEventListener('click', (e) => {
                if (e.target === e.currentTarget) closeDetailModal();
            });
            document.getElementById('deleteModal').addEventListener('click', (e) => {
                if (e.target === e.currentTarget) closeDeleteModal();
            });
        }

        // Utility function for debouncing
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Auto-save draft functionality
        function saveDraft() {
            try {
                const title = document.getElementById('blogTitle').value.trim();
                const author = document.getElementById('blogAuthor').value.trim();
                const summary = document.getElementById('blogSummary').value.trim();
                const content = document.getElementById('blogContent').value.trim();
                const url = document.getElementById('blogUrl').value.trim();

                // Only save if there's meaningful content
                if (title.length > 0 || author.length > 0 || summary.length > 0 || content.length > 0) {
                    const draftKey = editingBlogId ? `draft_edit_${editingBlogId}` : 'draft_new';
                    const draft = {
                        title,
                        author,
                        summary,
                        content,
                        url,
                        savedAt: new Date().toISOString(),
                        isEditing: !!editingBlogId,
                        editingId: editingBlogId
                    };

                    localStorage.setItem(draftKey, JSON.stringify(draft));
                    console.log('Draft saved automatically');
                }
            } catch (error) {
                console.error('Error saving draft:', error);
            }
        }

        function loadDraft() {
            try {
                const draftKey = editingBlogId ? `draft_edit_${editingBlogId}` : 'draft_new';
                const draftData = localStorage.getItem(draftKey);

                if (draftData) {
                    const draft = JSON.parse(draftData);
                    const savedTime = new Date(draft.savedAt);
                    const timeDiff = Date.now() - savedTime.getTime();

                    // Only load drafts saved within the last 24 hours
                    if (timeDiff < 24 * 60 * 60 * 1000) {
                        // Show custom restore draft dialog
                        showRestoreDraftDialog(draft, draftKey, savedTime);
                    } else {
                        // Remove old drafts
                        localStorage.removeItem(draftKey);
                    }
                }
            } catch (error) {
                console.error('Error loading draft:', error);
            }
        }

        function showRestoreDraftDialog(draft, draftKey, savedTime) {
            // Create and show custom restore draft dialog (for opening modal)
            const dialogHtml = `
                    <div id="restoreDraftDialog" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[70] p-4">
                        <div class="bg-gray-800 rounded-xl shadow-2xl w-full max-w-md">
                            <div class="p-6">
                                <div class="flex items-center mb-4">
                                    <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center mr-4">
                                        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-semibold text-white">Khôi phục bản nháp</h3>
                                        <p class="text-gray-300 text-sm">Tìm thấy bản nháp đã lưu</p>
                                    </div>
                                </div>
                                
                                <p class="text-gray-300 mb-6">Bạn có một bản nháp đã lưu vào lúc <strong class="text-white">${savedTime.toLocaleString('vi-VN')}</strong>. Bạn có muốn khôi phục nội dung này không?</p>
                                
                                <div class="flex space-x-3">
                                    <button id="restoreDraftBtn" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-medium py-2.5 px-4 rounded-lg transition-colors">
                                        Khôi phục
                                    </button>
                                    <button id="skipRestoreBtn" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-medium py-2.5 px-4 rounded-lg transition-colors">
                                        Bỏ qua
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

            // Remove existing dialog if any
            const existingDialog = document.getElementById('restoreDraftDialog');
            if (existingDialog) {
                existingDialog.remove();
            }

            // Add dialog to body
            document.body.insertAdjacentHTML('beforeend', dialogHtml);

            // Add event listeners
            document.getElementById('restoreDraftBtn').addEventListener('click', () => {
                // Restore the draft content
                document.getElementById('blogTitle').value = draft.title || '';
                document.getElementById('blogAuthor').value = draft.author || '';
                document.getElementById('blogSummary').value = draft.summary || '';
                document.getElementById('blogContent').value = draft.content || '';
                document.getElementById('blogUrl').value = draft.url || '';

                updateSummaryCounter();
                updateContentCounter();

                showNotification('✅ Đã khôi phục bản nháp', 'success');
                removeRestoreDraftDialog();
            });

            document.getElementById('skipRestoreBtn').addEventListener('click', () => {
                // Remove the draft if user doesn't want it
                localStorage.removeItem(draftKey);
                removeRestoreDraftDialog();
            });

            // Close dialog when clicking outside
            document.getElementById('restoreDraftDialog').addEventListener('click', (e) => {
                if (e.target === e.currentTarget) {
                    localStorage.removeItem(draftKey);
                    removeRestoreDraftDialog();
                }
            });
        }

        function removeRestoreDraftDialog() {
            const dialog = document.getElementById('restoreDraftDialog');
            if (dialog) {
                dialog.remove();
            }
        }

        function clearDraft() {
            try {
                const draftKey = editingBlogId ? `draft_edit_${editingBlogId}` : 'draft_new';
                localStorage.removeItem(draftKey);
                console.log('Draft cleared');
            } catch (error) {
                console.error('Error clearing draft:', error);
            }
        }

        function validateEnvironmentalContent(title, summary, content) {
            const allText = `${title} ${summary} ${content}`.toLowerCase();
            return environmentalKeywords.some(keyword =>
                allText.includes(keyword.toLowerCase())
            );
        }

        function handleBlogSubmit(e) {
            e.preventDefault();

            const title = document.getElementById('blogTitle').value.trim();
            const author = document.getElementById('blogAuthor').value.trim();
            const summary = document.getElementById('blogSummary').value.trim();
            const content = document.getElementById('blogContent').value.trim();
            const url = document.getElementById('blogUrl').value.trim();

            // Validate environmental content
            if (!validateEnvironmentalContent(title, summary, content)) {
                showNotification('❌ Nội dung không phù hợp với chủ đề bảo vệ môi trường. Vui lòng đăng bài về các nghiên cứu liên quan đến môi trường, khí hậu, sinh thái, hoặc bền vững.', 'error');
                return;
            }

            const blog = {
                id: editingBlogId || Date.now().toString(),
                title,
                author,
                summary,
                content,
                url: url || null,
                dateCreated: editingBlogId ?
                    blogs.find(b => b.id === editingBlogId)?.dateCreated || new Date().toISOString() :
                    new Date().toISOString(),
                dateModified: new Date().toISOString()
            };

            if (editingBlogId) {
                const index = blogs.findIndex(b => b.id === editingBlogId);
                if (index !== -1) {
                    blogs[index] = blog;
                    showNotification('✅ Đã cập nhật bài nghiên cứu thành công!', 'success');
                }
            } else {
                blogs.unshift(blog);
                showNotification('✅ Đã đăng bài nghiên cứu thành công!', 'success');
            }

            // Clear draft after successful save
            clearDraft();

            if (saveBlogs()) {
                renderBlogs();
                closeModal();
                resetForm();
            } else {
                showNotification('❌ Có lỗi khi lưu bài viết. Vui lòng thử lại.', 'error');
            }
        }

        function openModal(title, submitText) {
            isModalOpen = true;
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('submitBtnText').textContent = submitText;
            document.getElementById('blogModal').classList.remove('hidden');
            document.getElementById('blogModal').classList.add('flex');
            document.body.style.overflow = 'hidden';

            if (editingBlogId) {
                const blog = blogs.find(b => b.id === editingBlogId);
                if (blog) {
                    document.getElementById('blogTitle').value = blog.title;
                    document.getElementById('blogAuthor').value = blog.author;
                    document.getElementById('blogSummary').value = blog.summary;
                    document.getElementById('blogContent').value = blog.content;
                    document.getElementById('blogUrl').value = blog.url || '';
                    updateSummaryCounter();
                    updateContentCounter();
                }
            }

            // Load draft after setting existing content (if editing)
            setTimeout(() => loadDraft(), 100);
        }

        function closeModal() {
            const hasContent = ['blogTitle', 'blogAuthor', 'blogSummary', 'blogContent', 'blogUrl']
                .some(id => document.getElementById(id).value.trim().length > 0);

            if (hasContent) {
                showSaveDraftDialog();
            } else {
                clearDraft();
                performCloseModal();
            }
        }

        function performCloseModal() {
            isModalOpen = false;
            document.getElementById('blogModal').classList.add('hidden');
            document.getElementById('blogModal').classList.remove('flex');
            document.body.style.overflow = 'auto';
            resetForm();
        }

        function showSaveDraftDialog() {
            // Create and show custom save draft dialog
            const dialogHtml = `
                    <div id="saveDraftDialog" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[70] p-4">
                        <div class="bg-gray-800 rounded-xl shadow-2xl w-full max-w-md">
                            <div class="p-6">
                                <div class="flex items-center mb-4">
                                    <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center mr-4">
                                        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-semibold text-white">Lưu bản nháp?</h3>
                                        <p class="text-gray-300 text-sm">Bạn có nội dung chưa được lưu</p>
                                    </div>
                                </div>
                                
                                <p class="text-gray-300 mb-6">Bạn có muốn lưu bản nháp không?</p>
                                
                                <div class="flex space-x-3">
                                    <button id="saveDraftBtn" class="flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors duration-200">
                                        Lưu bản nháp
                                    </button>
                                    <button id="discardDraftBtn" class="flex-1 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors duration-200">
                                        Không lưu
                                    </button>
                                    <button id="cancelCloseBtn" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors duration-200">
                                        Tiếp tục chỉnh sửa
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

            // Remove existing dialog if any
            const existingDialog = document.getElementById('saveDraftDialog');
            if (existingDialog) {
                existingDialog.remove();
            }

            // Add dialog to body
            document.body.insertAdjacentHTML('beforeend', dialogHtml);

            // Add event listeners
            document.getElementById('saveDraftBtn').addEventListener('click', () => {
                saveDraft();
                showNotification('💾 Đã lưu bản nháp', 'info');
                removeSaveDraftDialog();
                performCloseModal();
            });

            document.getElementById('discardDraftBtn').addEventListener('click', () => {
                clearDraft();
                removeSaveDraftDialog();
                performCloseModal();
            });

            document.getElementById('cancelCloseBtn').addEventListener('click', () => {
                removeSaveDraftDialog();
                // Don't close the modal - user wants to continue editing
            });

            // Close dialog when clicking outside
            document.getElementById('saveDraftDialog').addEventListener('click', (e) => {
                if (e.target === e.currentTarget) {
                    removeSaveDraftDialog();
                }
            });
        }

        function removeSaveDraftDialog() {
            const dialog = document.getElementById('saveDraftDialog');
            if (dialog) {
                dialog.remove();
            }
        }

        function resetForm() {
            document.getElementById('blogForm').reset();
            document.getElementById('summaryCount').textContent = '0';
            document.getElementById('contentCount').textContent = '0';
            editingBlogId = null;
        }

        function updateSummaryCounter() {
            const text = document.getElementById('blogSummary').value;
            document.getElementById('summaryCount').textContent = text.length;
        }

        function updateContentCounter() {
            const text = document.getElementById('blogContent').value;
            document.getElementById('contentCount').textContent = text.length;
        }

        function renderBlogs() {
            const blogGrid = document.getElementById('blogGrid');
            const noBlogsMessage = document.getElementById('noBlogsMessage');

            if (blogs.length === 0) {
                blogGrid.innerHTML = '';
                noBlogsMessage.classList.remove('hidden');
                return;
            }

            noBlogsMessage.classList.add('hidden');
            blogGrid.innerHTML = blogs.map(blog => createBlogCard(blog)).join('');

            // Add click events to blog cards
            blogs.forEach(blog => {
                const card = document.getElementById(`blog-${blog.id}`);
                if (card) {
                    card.addEventListener('click', () => showBlogDetail(blog));
                }
            });
        }

        function createBlogCard(blog) {
            const date = new Date(blog.dateCreated).toLocaleDateString('vi-VN');
            const truncatedSummary = blog.summary.length > 150 ?
                blog.summary.substring(0, 150) + '...' : blog.summary;

            // Check if blog is new (posted within 24 hours)
            const isNewPost = isPostedWithin24Hours(blog.dateCreated);

            return `
                        <div id="blog-${blog.id}" class="blog-card bg-gray-800 rounded-lg p-6 hover:bg-gray-750 transition-all duration-200 cursor-pointer border border-gray-700 hover:border-green-500 group relative">
                            ${isNewPost ? `
                                <div class="absolute top-4 right-4 w-3 h-3 bg-green-500 rounded-full animate-pulse" title="Bài viết mới trong 24h"></div>
                            ` : ''}
                            <div class="flex items-start justify-between mb-3 ${isNewPost ? 'pr-6' : ''}">
                                <h3 class="font-semibold text-white text-lg leading-tight group-hover:text-green-400 transition-colors line-clamp-2">
                                    ${escapeHtml(blog.title)}
                                </h3>
                                <div class="flex space-x-2 ml-2">
                                    ${blog.url ? `
                                        <div class="w-2 h-2 bg-blue-500 rounded-full" title="Có link bài báo gốc"></div>
                                    ` : ''}
                                </div>
                            </div>
                            
                            <div class="text-gray-400 text-sm mb-3 flex items-center">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                </svg>
                                ${escapeHtml(blog.author)} • ${date}
                                ${isNewPost ? `
                                    <span class="ml-2 px-2 py-0.5 bg-green-600 text-green-100 text-xs rounded-full font-medium">MỚI</span>
                                ` : ''}
                            </div>
                            
                            <p class="text-gray-300 text-sm leading-relaxed line-clamp-4">
                                ${escapeHtml(truncatedSummary)}
                            </p>
                            
                            <div class="mt-4 flex items-center text-green-400 text-sm font-medium">
                                <span>Đọc thêm</span>
                                <svg class="w-4 h-4 ml-1 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </div>
                        </div>
                    `;
        }

        function showBlogDetail(blog) {
            const date = new Date(blog.dateCreated).toLocaleDateString('vi-VN', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            // Check if blog is new (posted within 24 hours)
            const isNewPost = isPostedWithin24Hours(blog.dateCreated);

            document.getElementById('detailTitle').textContent = blog.title;
            document.getElementById('detailAuthor').textContent = blog.author;

            // Add "MỚI" indicator to date if post is new
            const dateText = isNewPost ?
                `${date} • MỚI` : date;
            document.getElementById('detailDate').textContent = dateText;

            // Add visual styling for new posts in the date element
            const detailDateElement = document.getElementById('detailDate');
            if (isNewPost) {
                detailDateElement.innerHTML = `${date} <span class="ml-2 px-2 py-0.5 bg-green-600 text-green-100 text-xs rounded-full font-medium animate-pulse">MỚI</span>`;
            } else {
                detailDateElement.textContent = date;
            }

            document.getElementById('detailSummary').textContent = blog.summary;
            document.getElementById('detailContent').innerHTML = formatContent(blog.content);

            // Handle external URL
            const urlContainer = document.getElementById('detailUrlContainer');
            const urlLink = document.getElementById('detailUrl');
            if (blog.url) {
                urlLink.href = blog.url;
                urlContainer.classList.remove('hidden');
            } else {
                urlContainer.classList.add('hidden');
            }

            // Set up edit and delete buttons
            document.getElementById('editBlogBtn').onclick = () => {
                closeDetailModal();
                editingBlogId = blog.id;
                openModal('Chỉnh sửa bài nghiên cứu', 'Cập nhật');
            };

            document.getElementById('deleteBlogBtn').onclick = () => {
                document.getElementById('deleteModal').classList.remove('hidden');
                document.getElementById('deleteModal').classList.add('flex');
                document.getElementById('confirmDeleteBtn').onclick = () => {
                    deleteBlog(blog.id);
                    closeDeleteModal();
                    closeDetailModal();
                };
            };

            document.getElementById('blogDetailModal').classList.remove('hidden');
            document.getElementById('blogDetailModal').classList.add('flex');
            document.body.style.overflow = 'hidden';
        }

        function closeDetailModal() {
            document.getElementById('blogDetailModal').classList.add('hidden');
            document.getElementById('blogDetailModal').classList.remove('flex');
            document.body.style.overflow = 'auto';
        }

        function closeDeleteModal() {
            document.getElementById('deleteModal').classList.add('hidden');
            document.getElementById('deleteModal').classList.remove('flex');
        }

        function confirmDelete() {
            // This function will be set dynamically in showBlogDetail
        }

        function deleteBlog(id) {
            // Save the deleted blog to a separate recovery list before deleting
            const blogToDelete = blogs.find(blog => blog.id === id);
            if (blogToDelete) {
                saveDeletedBlog(blogToDelete);
            }

            blogs = blogs.filter(blog => blog.id !== id);

            // Remove individual blog state
            localStorage.removeItem(`blog_state_${id}`);

            saveBlogs();
            renderBlogs();
            showNotification('✅ Đã xóa bài nghiên cứu thành công!', 'success');
        }

        function saveDeletedBlog(blog) {
            try {
                const deletedBlogs = JSON.parse(localStorage.getItem('deletedBlogs') || '[]');
                deletedBlogs.unshift({
                    ...blog,
                    deletedAt: new Date().toISOString()
                });

                // Keep only last 10 deleted blogs to avoid storage overflow
                if (deletedBlogs.length > 10) {
                    deletedBlogs.splice(10);
                }

                localStorage.setItem('deletedBlogs', JSON.stringify(deletedBlogs));
            } catch (error) {
                console.error('Error saving deleted blog:', error);
            }
        }

        function formatContent(content) {
            return escapeHtml(content)
                .replace(/\n\n/g, '</p><p class="mb-4">')
                .replace(/\n/g, '<br>')
                .replace(/^(.*)$/, '<p class="mb-4">$1</p>');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Utility function to check if a blog post was created within 24 hours
        function isPostedWithin24Hours(dateCreated) {
            try {
                const postDate = new Date(dateCreated);
                const now = new Date();
                const timeDifference = now.getTime() - postDate.getTime();
                const twentyFourHoursInMs = 24 * 60 * 60 * 1000; // 24 hours in milliseconds

                return timeDifference <= twentyFourHoursInMs && timeDifference >= 0;
            } catch (error) {
                console.error('Error checking post date:', error);
                return false;
            }
        }

        function saveBlogs() {
            try {
                // Create backup before saving new data
                const currentData = localStorage.getItem('environmentalBlogs');
                if (currentData) {
                    localStorage.setItem('environmentalBlogs_backup', currentData);
                }

                // Add timestamp and metadata
                const dataToSave = {
                    version: '1.0',
                    lastModified: new Date().toISOString(),
                    blogCount: blogs.length,
                    blogs: blogs
                };

                localStorage.setItem('environmentalBlogs', JSON.stringify(dataToSave));

                // Save individual blog state for quick access
                blogs.forEach(blog => {
                    const blogState = {
                        id: blog.id,
                        title: blog.title,
                        author: blog.author,
                        dateCreated: blog.dateCreated,
                        dateModified: blog.dateModified,
                        wordCount: blog.content.length,
                        hasUrl: !!blog.url
                    };
                    localStorage.setItem(`blog_state_${blog.id}`, JSON.stringify(blogState));
                });

                console.log(`Successfully saved ${blogs.length} blogs to localStorage`);
                return true;
            } catch (error) {
                console.error('Error saving blogs:', error);
                showNotification('❌ Lỗi khi lưu dữ liệu! Vui lòng thử lại.', 'error');

                // Try to restore from backup if save failed
                try {
                    const backupData = localStorage.getItem('environmentalBlogs_backup');
                    if (backupData) {
                        localStorage.setItem('environmentalBlogs', backupData);
                        showNotification('🔄 Đã khôi phục từ bản sao lưu', 'info');
                    }
                } catch (backupError) {
                    console.error('Error restoring backup:', backupError);
                }
                return false;
            }
        }

        function loadBlogs() {
            try {
                const saved = localStorage.getItem('environmentalBlogs');

                if (saved) {
                    const parsedData = JSON.parse(saved);

                    // Handle both old format (direct array) and new format (with metadata)
                    if (Array.isArray(parsedData)) {
                        // Old format - migrate to new format
                        blogs = parsedData;
                        console.log('Migrated blogs from old format');
                        saveBlogs(); // Save in new format
                    } else if (parsedData.blogs && Array.isArray(parsedData.blogs)) {
                        // New format with metadata
                        blogs = parsedData.blogs;
                        console.log(`Loaded ${parsedData.blogCount} blogs (version ${parsedData.version})`);

                        // Validate data integrity
                        if (parsedData.blogCount !== blogs.length) {
                            console.warn('Blog count mismatch detected');
                            showNotification('⚠️ Phát hiện dữ liệu không đồng bộ', 'warning');
                        }
                    } else {
                        throw new Error('Invalid data format');
                    }

                    // Clean up orphaned individual blog states
                    cleanupOrphanedBlogStates();

                } else {
                    // No saved data - initialize with sample blogs
                    initializeSampleBlogs();
                }

                // Validate all blogs have required fields
                blogs = blogs.filter(blog => validateBlogData(blog));

            } catch (error) {
                console.error('Error loading blogs:', error);
                showNotification('❌ Lỗi khi tải dữ liệu. Đang thử khôi phục...', 'error');

                // Try to restore from backup
                if (tryRestoreFromBackup()) {
                    return;
                }

                // Last resort - initialize with sample data
                console.log('Initializing with sample data as fallback');
                initializeSampleBlogs();
            }
        }

        function validateBlogData(blog) {
            return blog &&
                typeof blog.id === 'string' &&
                typeof blog.title === 'string' &&
                typeof blog.author === 'string' &&
                typeof blog.summary === 'string' &&
                typeof blog.content === 'string' &&
                blog.title.trim().length > 0 &&
                blog.author.trim().length > 0 &&
                blog.content.trim().length > 0;
        }

        function tryRestoreFromBackup() {
            try {
                const backupData = localStorage.getItem('environmentalBlogs_backup');
                if (backupData) {
                    const parsedBackup = JSON.parse(backupData);
                    blogs = Array.isArray(parsedBackup) ? parsedBackup : parsedBackup.blogs;

                    if (blogs && blogs.length > 0) {
                        showNotification('✅ Đã khôi phục dữ liệu từ bản sao lưu', 'success');
                        saveBlogs(); // Save the restored data
                        return true;
                    }
                }
            } catch (error) {
                console.error('Error restoring from backup:', error);
            }
            return false;
        }

        function cleanupOrphanedBlogStates() {
            try {
                const blogIds = new Set(blogs.map(blog => blog.id));
                const keysToRemove = [];

                // Check all localStorage keys
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith('blog_state_')) {
                        const blogId = key.replace('blog_state_', '');
                        if (!blogIds.has(blogId)) {
                            keysToRemove.push(key);
                        }
                    }
                }

                // Remove orphaned states
                keysToRemove.forEach(key => localStorage.removeItem(key));

                if (keysToRemove.length > 0) {
                    console.log(`Cleaned up ${keysToRemove.length} orphaned blog states`);
                }
            } catch (error) {
                console.error('Error cleaning up orphaned states:', error);
            }
        }

        function initializeSampleBlogs() {
            blogs = [
                {
                    id: 'sample-1',
                    title: 'Tác động của biến đổi khí hậu đến đa dạng sinh học rừng nhiệt đới',
                    author: 'Example',
                    summary: 'Nghiên cứu toàn diện về ảnh hưởng của biến đổi khí hậu đến hệ sinh thái rừng nhiệt đới, bao gồm sự thay đổi trong chuỗi thức ăn, di cư của các loài động vật và tác động đến đa dạng sinh học.',
                    content: 'Biến đổi khí hậu đang tạo ra những thay đổi sâu sắc trong hệ sinh thái rừng nhiệt đới toàn cầu. Nghiên cứu này phân tích dữ liệu từ 15 khu rừng nhiệt đới trong 20 năm qua.\n\nKết quả cho thấy nhiệt độ tăng trung bình 1.2°C đã làm thay đổi chu kỳ sinh sản của nhiều loài động vật. Đặc biệt, các loài chim di cư đã thay đổi lịch trình di cư, ảnh hưởng đến quá trình thụ phần của thực vật.\n\nNghiên cứu cũng phát hiện ra rằng tần suất mưa bất thường đã làm giảm 23% diện tích rừng có thể sinh sống được cho các loài linh trưởng. Điều này dẫn đến cạnh tranh gay gắt hơn về nguồn thức ăn và không gian sống.\n\nĐể giảm thiểu tác động, nghiên cứu đề xuất các biện pháp bảo tồn tích cực như tạo hành lang sinh thái, bảo vệ các khu vực trú ẩn quan trọng và phát triển các chương trình tái sinh rừng thích ứng với khí hậu.',
                    url: null,
                    dateCreated: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(),
                    dateModified: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString()
                },
                {
                    id: 'sample-2',
                    title: 'Công nghệ tái chế nhựa mới: Từ rác thải đến năng lượng sạch',
                    author: 'Example',
                    summary: 'Công nghệ pyrolysis mới có thể chuyển đổi 95% rác thải nhựa thành nhiên liệu sinh học, mở ra hướng giải quyết khủng hoảng ô nhiễm nhựa toàn cầu.',
                    content: 'Rác thải nhựa đang trở thành một trong những thách thức môi trường lớn nhất của thế kỷ 21. Mỗi năm, thế giới sản xuất hơn 300 triệu tấn rác thải nhựa, trong đó chỉ có 9% được tái chế hiệu quả.\n\nNghiên cứu mới của nhóm chúng tôi đã phát triển thành công công nghệ pyrolysis nhiệt độ thấp có thể phân hủy các loại nhựa phức tạp thành nhiên liệu sinh học chất lượng cao. Quy trình này hoạt động ở 350°C, thấp hơn 200°C so với các phương pháp truyền thống.\n\nKết quả thử nghiệm cho thấy:\n- Hiệu suất chuyển đổi đạt 95%\n- Giảm 80% khí thải CO2 so với đốt rác\n- Tạo ra nhiên liệu có chất lượng tương đương xăng RON 92\n- Chi phí vận hành thấp hơn 40% các phương pháp hiện tại\n\nCông nghệ này không chỉ giải quyết vấn đề rác thải mà còn tạo ra nguồn năng lượng tái tạo. Chúng tôi ước tính có thể xử lý 1000 tấn rác nhựa mỗi ngày và tạo ra 800 lít nhiên liệu sinh học.',
                    url: 'https://example.com/plastic-recycling-research',
                    dateCreated: new Date(Date.now() - 12 * 60 * 60 * 1000).toISOString(), // 12 hours ago - NEW POST
                    dateModified: new Date(Date.now() - 12 * 60 * 60 * 1000).toISOString()
                },
                {
                    id: 'sample-3',
                    title: 'Ảnh hưởng của ô nhiễm không khí đến sức khỏe trẻ em tại các thành phố lớn',
                    author: 'Example',
                    summary: 'Nghiên cứu theo dõi 10,000 trẻ em trong 5 năm tại TP.HCM và Hà Nội, phát hiện mối liên hệ trực tiếp giữa nồng độ PM2.5 và tỷ lệ mắc bệnh hô hấp ở trẻ em.',
                    content: 'Ô nhiễm không khí đang trở thành "kẻ giết người thầm lặng" tại các thành phố lớn của Việt Nam. Nghiên cứu dài hạn này theo dõi sức khỏe của 10,000 trẻ em từ 6-12 tuổi tại TP.HCM và Hà Nội trong 5 năm (2018-2023).\n\nPhương pháp nghiên cứu bao gồm:\n- Đo lường hàng ngày nồng độ PM2.5, PM10, NO2, SO2\n- Theo dõi sức khỏe định kỳ của trẻ em\n- Phân tích mối tương quan giữa chất lượng không khí và tỷ lệ mắc bệnh\n\nKết quả đáng báo động:\n- Khi nồng độ PM2.5 vượt 50μg/m³, tỷ lệ trẻ mắc bệnh hô hấp tăng 40%\n- Trẻ em sống gần đường lớn có nguy cơ mắc hen suyễn cao gấp 2.3 lần\n- IQ trung bình của trẻ ở khu vực ô nhiễm nặng thấp hơn 5-7 điểm\n\nNghiên cứu cũng đề xuất các giải pháp:\n1. Tăng cường kiểm soát khí thải xe cộ\n2. Phát triển giao thông công cộ xanh\n3. Tạo thêm không gian xanh trong thành phố\n4. Giáo dục cộng đồng về tác hại của ô nhiễm không khí',
                    url: null,
                    dateCreated: new Date(Date.now() - 6 * 60 * 60 * 1000).toISOString(), // 6 hours ago - NEW POST
                    dateModified: new Date(Date.now() - 6 * 60 * 60 * 1000).toISOString()
                },
            ];
            console.log('Initialized with sample blogs');
            saveBlogs();
        }

        function showNotification(message, type = 'info') {
            // Remove existing notifications
            const existing = document.querySelector('.notification-toast');
            if (existing) existing.remove();

            const notification = document.createElement('div');
            notification.className = `notification-toast fixed top-4 right-4 px-6 py-4 rounded-lg shadow-xl z-[60] max-w-md ${type === 'success' ? 'bg-green-600 text-white' :
                type === 'error' ? 'bg-red-600 text-white' :
                    'bg-blue-600 text-white'
                } transform transition-all duration-300 translate-x-full`;

            notification.innerHTML = `
                        <div class="flex items-center">
                            <span class="mr-3">${message}</span>
                            <button onclick="this.parentElement.parentElement.remove()" class="text-white hover:text-gray-200">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                    `;

            document.body.appendChild(notification);

            // Animate in
            requestAnimationFrame(() => {
                notification.classList.remove('translate-x-full');
            });

            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.classList.add('translate-x-full');
                    setTimeout(() => notification.remove(), 300);
                }
            }, 5000);
        }

        // Additional localStorage management utilities
        function getStorageInfo() {
            try {
                const info = {
                    totalBlogs: blogs.length,
                    storageUsed: 0,
                    storageKeys: []
                };

                // Calculate storage usage
                for (let key in localStorage) {
                    if (localStorage.hasOwnProperty(key)) {
                        const value = localStorage[key];
                        info.storageUsed += key.length + value.length;
                        info.storageKeys.push(key);
                    }
                }

                info.storageUsed = Math.round(info.storageUsed / 1024); // Convert to KB
                return info;
            } catch (error) {
                console.error('Error getting storage info:', error);
                return null;
            }
        }

        function exportData() {
            try {
                const exportData = {
                    blogs,
                    exportDate: new Date().toISOString(),
                    version: '1.0'
                };

                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });

                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `environmental_blogs_backup_${new Date().toISOString().split('T')[0]}.json`;
                link.click();

                showNotification('✅ Đã xuất dữ liệu thành công!', 'success');
            } catch (error) {
                console.error('Error exporting data:', error);
                showNotification('❌ Lỗi khi xuất dữ liệu!', 'error');
            }
        }

        function importData(fileInput) {
            const file = fileInput.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const importedData = JSON.parse(e.target.result);

                    if (importedData.blogs && Array.isArray(importedData.blogs)) {
                        const validBlogs = importedData.blogs.filter(blog => validateBlogData(blog));

                        if (validBlogs.length > 0) {
                            const shouldReplace = confirm(
                                `Tìm thấy ${validBlogs.length} bài hợp lệ. Bạn có muốn thay thế dữ liệu hiện tại không?`
                            );

                            if (shouldReplace) {
                                blogs = validBlogs;
                                saveBlogs();
                                renderBlogs();
                                showNotification(`✅ Đã nhập ${validBlogs.length} bài thành công!`, 'success');
                            } else {
                                blogs = [...blogs, ...validBlogs];
                                saveBlogs();
                                renderBlogs();
                                showNotification(`✅ Đã thêm ${validBlogs.length} bài mới!`, 'success');
                            }
                        } else {
                            showNotification('❌ Không tìm thấy dữ liệu hợp lệ!', 'error');
                        }
                    } else {
                        showNotification('❌ Định dạng file không đúng!', 'error');
                    }
                } catch (error) {
                    console.error('Error importing data:', error);
                    showNotification('❌ Lỗi khi nhập dữ liệu!', 'error');
                }
            };
            reader.readAsText(file);
        }

        // Clean up old data periodically
        function cleanupOldData() {
            try {
                const oneWeekAgo = Date.now() - (7 * 24 * 60 * 60 * 1000);

                // Clean up old drafts
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && (key.startsWith('draft_') || key.startsWith('blog_state_'))) {
                        try {
                            const data = JSON.parse(localStorage.getItem(key));
                            const savedTime = new Date(data.savedAt || data.dateModified || 0).getTime();

                            if (savedTime < oneWeekAgo) {
                                localStorage.removeItem(key);
                            }
                        } catch (e) {
                            // Remove corrupted entries
                            localStorage.removeItem(key);
                        }
                    }
                }
            } catch (error) {
                console.error('Error cleaning up old data:', error);
            }
        }

        // Auto-cleanup on page load
        cleanupOldData();

        // Expose utilities for debugging (development only)
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            window.blogUtils = {
                getStorageInfo,
                exportData,
                cleanupOldData,
                loadBlogs,
                saveBlogs,
                blogs: () => blogs
            };
        }
        updateCartCount();
    })();
</script>
</body>

</html>